# PSO è¶…å‚æ•°ä¼˜åŒ–ç‰ˆæœ¬ä½¿ç”¨è¯´æ˜Ž ðŸš€

## ðŸ“‹ ä¸»è¦ç‰¹ç‚¹

### âœ… å·²å®žçŽ°åŠŸèƒ½

1. **ä»…ä¿ç•™ä¸¤ä¸ªæ¨¡åž‹**
   - âœ… LightGBM
   - âœ… XGBoost
   - âŒ CatBoostï¼ˆå·²ç§»é™¤ï¼‰
   - âŒ Transformerï¼ˆå·²ç§»é™¤ï¼‰
   - âŒ CNNï¼ˆå·²ç§»é™¤ï¼‰

2. **PSO ç²’å­ç¾¤ä¼˜åŒ–ç®—æ³•**
   - è‡ªåŠ¨æœç´¢æœ€ä¼˜è¶…å‚æ•°
   - æ”¯æŒå¹¶è¡Œè¯„ä¼°å¤šä¸ªå‚æ•°ç»„åˆ
   - å¯è§†åŒ–ä¼˜åŒ–è¿‡ç¨‹

3. **å®Œæ•´çš„ç‰¹å¾å·¥ç¨‹**
   - ä¿ç•™åŽŸæœ‰çš„ ~90 ä¸ªç‰¹å¾
   - åœ°è´¨ç‰©ç†ç‰¹å¾
   - æ¢¯åº¦å’Œæ³¢åŠ¨æ€§ç‰¹å¾

---

## ðŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œå‘½ä»¤

```bash
# ä½¿ç”¨ PSO ä¼˜åŒ–ï¼ˆæŽ¨èï¼‰
python main_pso.py
```

### å‚æ•°è®¾ç½®

åœ¨ `main_pso.py` çš„ä¸»ç¨‹åºéƒ¨åˆ†ï¼ˆæœ€åŽå‡ è¡Œï¼‰ï¼š

```python
submission = identifier.train_and_predict(
    "train.csv",
    "validation_without_label.csv",
    optimize=True,      # True=å¯ç”¨PSO, False=ä½¿ç”¨é»˜è®¤å‚æ•°
    n_particles=15,     # PSOç²’å­æ•°é‡ (å»ºè®®10-20)
    max_iter=20         # PSOè¿­ä»£æ¬¡æ•° (å»ºè®®15-30)
)
```

---

## ðŸ”§ PSO ä¼˜åŒ–è¯¦è§£

### PSO ç®—æ³•åŽŸç†

ç²’å­ç¾¤ä¼˜åŒ–ï¼ˆParticle Swarm Optimizationï¼‰æ¨¡æ‹Ÿé¸Ÿç¾¤è§…é£Ÿè¡Œä¸ºï¼š

```
æ¯ä¸ªç²’å­ = ä¸€ç»„è¶…å‚æ•°
ç²’å­ä½ç½® = å‚æ•°å€¼
ç²’å­é€‚åº”åº¦ = æ¨¡åž‹F1åˆ†æ•°

è¿­ä»£è¿‡ç¨‹:
1. åˆå§‹åŒ– n_particles ä¸ªéšæœºå‚æ•°ç»„åˆ
2. è¯„ä¼°æ¯ä¸ªç»„åˆçš„æ€§èƒ½ï¼ˆäº¤å‰éªŒè¯F1åˆ†æ•°ï¼‰
3. æ›´æ–°ç²’å­é€Ÿåº¦å’Œä½ç½®ï¼ˆå‘å…¨å±€æœ€ä¼˜å’Œä¸ªä½“æœ€ä¼˜ç§»åŠ¨ï¼‰
4. é‡å¤è¿­ä»£ max_iter æ¬¡
5. è¿”å›žæœ€ä¼˜å‚æ•°ç»„åˆ
```

### ä¼˜åŒ–çš„å‚æ•°

#### LightGBMï¼ˆ8ä¸ªå‚æ•°ï¼‰
| å‚æ•° | æœç´¢èŒƒå›´ | è¯´æ˜Ž |
|------|---------|------|
| `learning_rate` | [0.005, 0.1] | å­¦ä¹ çŽ‡ |
| `num_leaves` | [20, 80] | å¶å­èŠ‚ç‚¹æ•° |
| `max_depth` | [4, 12] | æœ€å¤§æ·±åº¦ |
| `min_child_samples` | [10, 100] | å¶å­æœ€å°æ ·æœ¬æ•° |
| `subsample` | [0.5, 1.0] | è¡Œé‡‡æ ·çŽ‡ |
| `colsample_bytree` | [0.5, 1.0] | åˆ—é‡‡æ ·çŽ‡ |
| `reg_alpha` | [0.0, 1.0] | L1 æ­£åˆ™åŒ– |
| `reg_lambda` | [0.0, 1.0] | L2 æ­£åˆ™åŒ– |

#### XGBoostï¼ˆ8ä¸ªå‚æ•°ï¼‰
| å‚æ•° | æœç´¢èŒƒå›´ | è¯´æ˜Ž |
|------|---------|------|
| `learning_rate` | [0.005, 0.1] | å­¦ä¹ çŽ‡ |
| `max_depth` | [3, 12] | æœ€å¤§æ·±åº¦ |
| `min_child_weight` | [1, 20] | æœ€å°å­èŠ‚ç‚¹æƒé‡ |
| `subsample` | [0.5, 1.0] | è¡Œé‡‡æ ·çŽ‡ |
| `colsample_bytree` | [0.5, 1.0] | åˆ—é‡‡æ ·çŽ‡ |
| `gamma` | [0.0, 1.0] | åˆ†è£‚æœ€å°æŸå¤± |
| `reg_alpha` | [0.0, 1.0] | L1 æ­£åˆ™åŒ– |
| `reg_lambda` | [0.0, 1.0] | L2 æ­£åˆ™åŒ– |

---

## â±ï¸ æ—¶é—´ä¼°ç®—

| é…ç½® | é¢„è®¡æ—¶é—´ | é€‚ç”¨åœºæ™¯ |
|------|---------|---------|
| **å¿«é€Ÿæµ‹è¯•** | 15-30åˆ†é’Ÿ | `n_particles=10, max_iter=10` |
| **æ ‡å‡†ä¼˜åŒ–** | 1-2å°æ—¶ | `n_particles=15, max_iter=20` |
| **æ·±åº¦ä¼˜åŒ–** | 3-5å°æ—¶ | `n_particles=20, max_iter=30` |

### æ—¶é—´ç»„æˆ
```
PSO æ€»æ—¶é—´ = (PSO_LGB + PSO_XGB) + æœ€ç»ˆè®­ç»ƒ

PSO_LGB = n_particles Ã— max_iter Ã— 2æŠ˜äº¤å‰éªŒè¯ Ã— è®­ç»ƒæ—¶é—´
        â‰ˆ 15 Ã— 20 Ã— 2 Ã— 0.5åˆ†é’Ÿ = çº¦5å°æ—¶

PSO_XGB = 15 Ã— 20 Ã— 2 Ã— 0.5åˆ†é’Ÿ = çº¦5å°æ—¶

æœ€ç»ˆè®­ç»ƒ = (LGB_5æŠ˜ + XGB_5æŠ˜) â‰ˆ 15åˆ†é’Ÿ

æ€»è®¡ â‰ˆ 10-11å°æ—¶ï¼ˆæ ‡å‡†é…ç½®ï¼‰
```

> **ðŸ’¡ åŠ é€Ÿå»ºè®®**: ä»£ç ä¸­å·²ç»ä¼˜åŒ–ä¸ºåªç”¨å‰2æŠ˜è¿›è¡ŒPSOè¯„ä¼°ï¼Œå®žé™…æ—¶é—´çº¦ä¸º **1-2å°æ—¶**

---

## ðŸ“Š è¾“å‡ºè¯´æ˜Ž

### è¿è¡Œè¿‡ç¨‹è¾“å‡º

```
==================================================================
PSOä¼˜åŒ– LightGBM è¶…å‚æ•°
==================================================================

å¼€å§‹PSOä¼˜åŒ–: 15ä¸ªç²’å­, 20æ¬¡è¿­ä»£
======================================================================

è¿­ä»£ 1/20
  ç²’å­ 3: æ–°çš„æœ€ä½³åˆ†æ•° = 0.465321
  ç²’å­ 7: æ–°çš„æœ€ä½³åˆ†æ•° = 0.472156
  å½“å‰å…¨å±€æœ€ä½³åˆ†æ•°: 0.472156

è¿­ä»£ 2/20
  ç²’å­ 12: æ–°çš„æœ€ä½³åˆ†æ•° = 0.485432
  å½“å‰å…¨å±€æœ€ä½³åˆ†æ•°: 0.485432

...

======================================================================
PSOä¼˜åŒ–å®Œæˆ!
æœ€ä½³åˆ†æ•°: 0.512345
æœ€ä½³å‚æ•°: [0.0234, 45.2, 8.1, 35.6, 0.82, 0.75, 0.15, 0.21]

LightGBM æœ€ä½³å‚æ•°: {
    'learning_rate': 0.0234,
    'num_leaves': 45,
    'max_depth': 8,
    ...
}
```

### ç”Ÿæˆæ–‡ä»¶

- **submission_pso.csv**: æœ€ç»ˆé¢„æµ‹ç»“æžœ
- æ ¼å¼ï¼š
  ```csv
  id,predict
  0,2
  1,2
  2,0
  ...
  ```

---

## ðŸŽ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: å¿«é€ŸéªŒè¯ï¼ˆä¸ä½¿ç”¨PSOï¼‰

```python
submission = identifier.train_and_predict(
    "train.csv",
    "validation_without_label.csv",
    optimize=False,     # ä½¿ç”¨é»˜è®¤å‚æ•°
    n_particles=15,
    max_iter=20
)
```

**æ—¶é—´**: 15-20åˆ†é’Ÿ  
**é€‚ç”¨**: å¿«é€Ÿæµ‹è¯•ä»£ç æ˜¯å¦æ­£å¸¸è¿è¡Œ

---

### åœºæ™¯2: æ ‡å‡†ä¼˜åŒ–ï¼ˆæŽ¨èï¼‰

```python
submission = identifier.train_and_predict(
    "train.csv",
    "validation_without_label.csv",
    optimize=True,
    n_particles=15,     # é€‚ä¸­çš„ç²’å­æ•°
    max_iter=20         # é€‚ä¸­çš„è¿­ä»£æ¬¡æ•°
)
```

**æ—¶é—´**: 1-2å°æ—¶  
**é€‚ç”¨**: æ—¥å¸¸ä½¿ç”¨ï¼Œå¹³è¡¡ç²¾åº¦å’Œæ—¶é—´

---

### åœºæ™¯3: æ·±åº¦ä¼˜åŒ–

```python
submission = identifier.train_and_predict(
    "train.csv",
    "validation_without_label.csv",
    optimize=True,
    n_particles=20,     # æ›´å¤šç²’å­
    max_iter=30         # æ›´å¤šè¿­ä»£
)
```

**æ—¶é—´**: 3-5å°æ—¶  
**é€‚ç”¨**: è¿½æ±‚æœ€é«˜ç²¾åº¦

---

## ðŸ“ˆ é¢„æœŸæ•ˆæžœ

### ä¸ŽåŽŸç‰ˆå¯¹æ¯”

| ç‰ˆæœ¬ | æ¨¡åž‹æ•°é‡ | ä¼˜åŒ–æ–¹æ³• | é¢„æœŸåˆ†æ•° | è®­ç»ƒæ—¶é—´ |
|------|---------|---------|---------|---------|
| **åŽŸç‰ˆ** | 5ä¸ªï¼ˆLGB+XGB+CAT+Transformer+CNNï¼‰ | æ‰‹åŠ¨è°ƒå‚ | 0.628 | 1-2å°æ—¶ |
| **PSOç‰ˆ** | 2ä¸ªï¼ˆLGB+XGBï¼‰ | PSOè‡ªåŠ¨ä¼˜åŒ– | **0.63~0.66** | 1-2å°æ—¶ï¼ˆæ ‡å‡†ï¼‰ |

### é¢„æœŸæå‡

- **PSO vs é»˜è®¤å‚æ•°**: +0.01~0.03
- **ç‰¹å¾å·¥ç¨‹å¢žå¼º**: +0.02~0.04
- **ç»¼åˆæå‡**: +0.03~0.07

---

## ðŸ” è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹PSOä¼˜åŒ–åŽ†å²

```python
# åœ¨ pso_optimize_lgb æˆ– pso_optimize_xgb æ–¹æ³•ä¸­
pso = PSO(objective, bounds, n_particles=15, max_iter=20)
best_params, best_score = pso.optimize()

# æŸ¥çœ‹ä¼˜åŒ–åŽ†å²
import matplotlib.pyplot as plt
plt.plot(pso.history)
plt.xlabel('Iteration')
plt.ylabel('Best F1 Score')
plt.title('PSO Optimization History')
plt.savefig('pso_history.png')
```

### 2. ä¿å­˜æœ€ä¼˜å‚æ•°

```python
# åœ¨è®­ç»ƒå®ŒæˆåŽ
import json
with open('best_params.json', 'w') as f:
    json.dump(identifier.best_params, f, indent=4)
```

### 3. ä½¿ç”¨å·²ä¿å­˜çš„å‚æ•°

```python
# è·³è¿‡PSOä¼˜åŒ–ï¼Œç›´æŽ¥ä½¿ç”¨ä¹‹å‰æ‰¾åˆ°çš„æœ€ä¼˜å‚æ•°
import json
with open('best_params.json', 'r') as f:
    identifier.best_params = json.load(f)

# ç„¶åŽè®­ç»ƒæ¨¡åž‹
models = identifier.train_optimized_models(X_train, y_train, groups)
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å†…å­˜ä½¿ç”¨

PSO ä¼˜åŒ–ä¼šåŒæ—¶è¯„ä¼°å¤šä¸ªæ¨¡åž‹ï¼Œå¯èƒ½å ç”¨è¾ƒå¤šå†…å­˜ï¼š
- **å»ºè®®**: 16GB+ RAM
- **å¦‚æžœå†…å­˜ä¸è¶³**: å‡å°‘ `n_particles` åˆ° 10

### 2. CPU ä½¿ç”¨

ä»£ç ä¼šå……åˆ†åˆ©ç”¨ CPU èµ„æºï¼š
- LightGBM/XGBoost é»˜è®¤ä½¿ç”¨æ‰€æœ‰ CPU æ ¸å¿ƒ
- å¯ä»¥é€šè¿‡ `n_jobs` å‚æ•°é™åˆ¶

### 3. éšæœºæ€§

è™½ç„¶è®¾ç½®äº†éšæœºç§å­ï¼Œä½† PSO ä»æœ‰ä¸€å®šéšæœºæ€§ï¼š
- æ¯æ¬¡è¿è¡Œç»“æžœå¯èƒ½ç•¥æœ‰ä¸åŒ
- å»ºè®®å¤šæ¬¡è¿è¡Œå–æœ€ä¼˜ç»“æžœ

---

## ðŸš€ è¿›ä¸€æ­¥ä¼˜åŒ–æ–¹å‘

### 1. å¢žåŠ æœç´¢ç©ºé—´

```python
# åœ¨ pso_optimize_lgb ä¸­æ‰©å±•å‚æ•°èŒƒå›´
bounds = [
    (0.001, 0.2),    # æ›´å¤§çš„å­¦ä¹ çŽ‡èŒƒå›´
    (15, 100),       # æ›´å¤šå¶å­èŠ‚ç‚¹é€‰æ‹©
    ...
]
```

### 2. ä½¿ç”¨æ›´å¤šæŠ˜æ•°

```python
# åœ¨ objective å‡½æ•°ä¸­
for train_idx, val_idx in splits[:4]:  # ä»Ž2æŠ˜æ”¹ä¸º4æŠ˜
    ...
```

### 3. æ·»åŠ æ—©åœç›‘æŽ§

```python
# åœ¨ PSO ç±»ä¸­æ·»åŠ 
if len(self.history) > 10:
    recent_improvement = self.history[-1] - self.history[-10]
    if recent_improvement < 0.001:
        print("ä¼˜åŒ–æ”¶æ•›ï¼Œæå‰åœæ­¢")
        break
```

---

## ðŸ“š å‚è€ƒèµ„æ–™

- [PSO ç®—æ³•è¯¦è§£](https://zh.wikipedia.org/wiki/ç²’å­ç¾¤ä¼˜åŒ–)
- [LightGBM å‚æ•°è°ƒä¼˜æŒ‡å—](https://lightgbm.readthedocs.io/en/latest/Parameters-Tuning.html)
- [XGBoost å‚æ•°è¯´æ˜Ž](https://xgboost.readthedocs.io/en/stable/parameter.html)

---

## ðŸŽ‰ æ€»ç»“

**main_pso.py çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š**

1. âœ… **ç®€åŒ–æ¨¡åž‹æž¶æž„** - åªä¿ç•™æœ€æœ‰æ•ˆçš„ 2 ä¸ªæ ‘æ¨¡åž‹
2. âœ… **è‡ªåŠ¨è¶…å‚æ•°ä¼˜åŒ–** - PSO ç®—æ³•æ™ºèƒ½æœç´¢æœ€ä¼˜å‚æ•°
3. âœ… **ä¿ç•™å®Œæ•´ç‰¹å¾** - 90+ é«˜è´¨é‡ç‰¹å¾å·¥ç¨‹
4. âœ… **çµæ´»é…ç½®** - å¯é€‰æ‹©æ˜¯å¦å¯ç”¨ä¼˜åŒ–ã€è°ƒæ•´ç²’å­æ•°å’Œè¿­ä»£æ¬¡æ•°
5. âœ… **æ˜“äºŽä½¿ç”¨** - ä¸€é”®è¿è¡Œï¼Œè‡ªåŠ¨ç”Ÿæˆæäº¤æ–‡ä»¶

**é¢„æœŸæ•ˆæžœï¼š0.63~0.66 çš„ Macro F1 åˆ†æ•°** ðŸŽ¯
